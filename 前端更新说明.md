# 前端页面更新说明

## 更新时间
2025-10-21

## 已更新的页面

### 1. 创建大作业页面 (`create_major_assignment.html`)

#### 主要变更：
- ❌ **移除**：单选框（上传文件 / 提供链接）
- ✅ **新增**：多附件上传区域
  - 支持同时选择多个文件
  - 实时显示已选文件列表和大小
  - 文件大小自动格式化（KB/MB）

- ✅ **新增**：多链接管理区域
  - 动态添加/删除链接
  - 每个链接可设置标题
  - 支持无限数量的链接

#### 使用方式：
1. **上传附件**：点击"附件文件"区域的文件选择框，可按住Ctrl/Cmd多选文件
2. **添加链接**：点击"添加链接"按钮，填写链接标题和地址
3. **删除链接**：点击链接右侧的"删除"按钮

### 2. 编辑大作业页面 (`edit_major_assignment.html`)

#### 主要变更：
- ❌ **移除**：单选框（上传新文件 / 提供新链接 / 保持不变）
- ✅ **新增**：当前资料展示区域
  - 列出所有已上传的附件
  - 列出所有已添加的链接
  - 区分新旧系统的资料（旧系统资料标记为"旧系统"）
  - 支持勾选删除附件和链接

- ✅ **新增**：添加新资料区域
  - 上传新附件（多文件）
  - 添加新链接（动态添加）

#### 使用方式：
1. **查看现有资料**：页面自动显示所有已有的附件和链接
2. **删除资料**：勾选要删除的附件/链接，提交表单后生效
3. **添加新资料**：在下方区域上传新文件或添加新链接

## 前后端交互说明

### 创建大作业
**提交的表单数据：**
- `requirement_files`: 多个文件（`<input type="file" multiple>`）
- `requirement_urls[]`: 多个链接地址（数组）
- `requirement_url_titles[]`: 多个链接标题（数组）

**后端处理：**
```python
# 获取多个文件
requirement_files = request.files.getlist('requirement_files')

# 获取多个链接
requirement_urls = request.form.getlist('requirement_urls')
requirement_url_titles = request.form.getlist('requirement_url_titles')
```

### 编辑大作业
**提交的表单数据：**
- `requirement_files`: 新上传的多个文件
- `requirement_urls[]`: 新添加的多个链接
- `requirement_url_titles[]`: 新链接的标题
- `delete_attachments[]`: 要删除的附件ID数组
- `delete_links[]`: 要删除的链接ID数组

**后端处理：**
```python
# 处理新附件
requirement_files = request.files.getlist('requirement_files')

# 处理新链接
requirement_urls = request.form.getlist('requirement_urls')
requirement_url_titles = request.form.getlist('requirement_url_titles')

# 处理删除
delete_attachment_ids = request.form.getlist('delete_attachments')
delete_link_ids = request.form.getlist('delete_links')
```

## 向后兼容性

### 旧数据处理：
- 旧系统的单个附件通过 `major_assignment.requirement_file_path` 存储
- 旧系统的单个链接通过 `major_assignment.requirement_url` 存储
- 新增的辅助方法 `get_all_attachments()` 和 `get_all_links()` 会自动合并新旧数据

### 模板中的使用：
```html
<!-- 获取所有附件（包括新旧系统） -->
{% set all_attachments = major_assignment.get_all_attachments() %}
{% for attachment in all_attachments %}
  {% if attachment.is_old %}
    <!-- 旧系统附件 -->
  {% else %}
    <!-- 新系统附件 -->
  {% endif %}
{% endfor %}

<!-- 获取所有链接（包括新旧系统） -->
{% set all_links = major_assignment.get_all_links() %}
{% for link in all_links %}
  {% if link.is_old %}
    <!-- 旧系统链接 -->
  {% else %}
    <!-- 新系统链接 -->
  {% endif %}
{% endfor %}
```

## JavaScript功能

### 文件预览
- 选择文件后自动显示文件列表
- 显示文件名和文件大小
- 支持清空重选

### 动态链接管理
- `addLinkInput()`: 添加新的链接输入框
- `removeLinkInput(id)`: 删除指定的链接输入框
- 每个链接都有独立的ID，避免冲突

### 表单验证
- 链接地址必填（URL格式）
- 链接标题可选
- 组队人数验证（最小不能大于最大）

## 测试建议

### 功能测试：
1. ✅ 创建大作业时上传多个附件
2. ✅ 创建大作业时添加多个链接
3. ✅ 同时上传附件和添加链接
4. ✅ 编辑大作业时添加新附件
5. ✅ 编辑大作业时添加新链接
6. ✅ 编辑大作业时删除已有附件
7. ✅ 编辑大作业时删除已有链接
8. ✅ 下载附件功能
9. ✅ 查看链接功能
10. ✅ 旧数据兼容性（旧大作业的附件和链接正常显示）

### 浏览器兼容性：
- Chrome/Edge（推荐）
- Firefox
- Safari

## 已知问题
无

## 后续优化建议
1. 添加附件上传进度条
2. 支持拖拽上传文件
3. 支持附件预览（图片、PDF）
4. 添加链接有效性验证
5. 支持批量删除附件/链接
